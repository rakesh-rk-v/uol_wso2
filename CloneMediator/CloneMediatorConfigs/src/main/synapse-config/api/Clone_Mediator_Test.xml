<?xml version="1.0" encoding="UTF-8"?>
<api context="/clone" name="Clone_Mediator_Test" xmlns="http://ws.apache.org/ns/synapse">
    <resource methods="POST GET">
        <inSequence>
            <log>
                <property name="Welcome" value="Log"/>
            </log>
            <clone id="Clone" sequential="true">
                <target>
                    <sequence>
                        <call>
                            <endpoint>
                                <http method="get" uri-template="https://httpbin.org/get">
                                    <suspendOnFailure>
                                        <initialDuration>-1</initialDuration>
                                        <progressionFactor>-1</progressionFactor>
                                        <maximumDuration>0</maximumDuration>
                                    </suspendOnFailure>
                                    <markForSuspension>
                                        <retriesBeforeSuspension>0</retriesBeforeSuspension>
                                    </markForSuspension>
                                </http>
                            </endpoint>
                        </call>
                        <log>
                            <property name="Calling" value="Firste"/>
                        </log>
                    </sequence>
                </target>
                <target>
                    <sequence>
                        <call>
                            <endpoint>
                                <http method="get" uri-template="https://reqres.in/api/users">
                                    <suspendOnFailure>
                                        <initialDuration>-1</initialDuration>
                                        <progressionFactor>-1</progressionFactor>
                                        <maximumDuration>0</maximumDuration>
                                    </suspendOnFailure>
                                    <markForSuspension>
                                        <retriesBeforeSuspension>0</retriesBeforeSuspension>
                                    </markForSuspension>
                                </http>
                            </endpoint>
                        </call>
                        <log>
                            <property name="Calling" value="Second"/>
                        </log>
                    </sequence>
                </target>
            </clone>
            <payloadFactory media-type="json">
                <format>$1</format>
                <args>
                    <arg evaluator="json" expression="$"/>
                </args>
            </payloadFactory>
            <aggregate id="Clone">
                <completeCondition>
                    <messageCount max="-1" min="-1"/>
                </completeCondition>
                <onComplete aggregateElementType="root" expression="json-eval($)">
                    <log level="full">
                        <property name="Inside Aggregate" value="Aggregate"/>
                    </log>
                    <respond/>
                </onComplete>
            </aggregate>
            <log level="full">
                <property name="OutSide" value="Aggregate"/>
            </log>
            <respond/>
        </inSequence>
        <outSequence/>
        <faultSequence/>
    </resource>
</api>
